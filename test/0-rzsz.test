# Test Rz/Sz
# Scott Bronson
# 4 Nov 2004

# Ensures that the "rz" and "sz" utilities can interoprate without
# error.  If not, then this needs to be fixed before running rzh!


rm -rf /tmp/tmtest-zmodem /tmp/tmtest-zmodem-pipe /tmp/tmtest-zmodem-data

mkdir /tmp/tmtest-zmodem
mkfifo /tmp/tmtest-zmodem-pipe

randfile --seed=1 --size=512 > /tmp/tmtest-zmodem-data

# sz outputs sometimes outputs a ^M on stderr so we need to just discard it.
sz -q /tmp/tmtest-zmodem-data 2>/dev/null < /tmp/tmtest-zmodem-pipe | \
	(cd /tmp/tmtest-zmodem && exec rz -q > /tmp/tmtest-zmodem-pipe)

randfile --seed=1 --size=512 --check < /tmp/tmtest-zmodem/tmtest-zmodem-data

------ STDOUT: exit code 0 - no error
